import{V as j,c as $,r as E,w as A,e as i,f as r,x as _,j as N,L as b,l as k,P as h,H as v,k as d,a3 as F,a4 as I,h as u,v as c,F as T,i as L,o as K,d as Q,y as O,a5 as z,t as g,Q as G,a6 as Z}from"./index-CV6KFYyF.js";var q=Object.defineProperty,J=(o,t,e)=>t in o?q(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e,U=(o,t,e)=>J(o,typeof t!="symbol"?t+"":t,e);function W(o){return String(o).replace(/(\d+)(\.)?/,(t,e,n)=>{const a=parseInt(e,10)-1;return n?`${a}.`:`${a}`})}function X(o,t){const e=new URL(o);return t&&Object.entries(t).forEach(([n,a])=>{e.searchParams.append(n,a.toString())}),e.toString()}async function Y(o,{method:t,data:e,parameters:n}={}){try{const a={method:t||"GET",headers:{"Content-Type":"application/json"},body:e?JSON.stringify(e):void 0},s=await fetch(X(o,n),a);if(!s.ok)throw new Error(`Error response: ${s.status} ${s.statusText}`);return await s.json()}catch(a){throw console.error("Error:",a),a}}class B{constructor(t){U(this,"baseUrl"),U(this,"projectToken"),this.baseUrl=t.baseUrl,this.projectToken=t.projectToken}getDichotomousKey(t){return Y(`${this.baseUrl}/leads/key/${t}`,{parameters:{project_token:this.projectToken}})}}function ee(o){return{children:o.children||[],coupletNumber:o.couplet_number,parentId:o.parent_id,depth:o.depth,position:o.position}}function te(o,{baseUrl:t,projectToken:e}){var n;return{caption:o.caption,label:o.label,position:o.position,image:o.medium,original:`${t}/${(n=o.original_png)==null?void 0:n.substring(8)}?project_token=${e}`}}function ne(o,t){var e;return{text:o.text,parentId:o.parent_id,targetId:o.target_id,targetLabel:o.target_label,targetType:o.target_type,position:o.position,figures:((e=o.figures)==null?void 0:e.map(n=>te(n,t)))||[]}}function P(o){return{currentNode:null,metadata:null,entries:{},leads:{},nodes:{},config:o}}function oe(o){let t=new B(o);const e=F(P(o));function n(l){return Object.fromEntries(Object.entries(l).map(([m,f])=>[m,ee(f)]))}function a(l){e.config=l,t=new B(l)}function s(){Object.assign(e,P(o))}function p(l){return Object.fromEntries(Object.entries(l).map(([m,f])=>[m,ne(f,e.config)]))}function y(l,m){const f={};for(const[C,w]of Object.entries(m)){const V=l[C];f[C]={id:parseInt(C,10),...w,...V},V||Object.assign(f[C],{children:[]})}return f}return{state:e,loadKey:l=>t.getDichotomousKey(l).then(({data:m,metadata:f})=>{e.entries=n(m.entries),e.leads=p(m.leads),e.nodes=y(e.entries,e.leads),e.currentNode=Object.values(e.nodes)[0],e.metadata=f}),setCurrentNode:l=>{e.currentNode=e.nodes[l]},setConfig:a,reset:s}}const ae={class:"pinpoint-tree"},se=["innerHTML"],re={key:0},S=j({__name:"Tree",props:{node:{},coupletNumber:{}},setup(o){const t=I("store");return(e,n)=>(r(),i("ul",ae,[u("li",null,[u("span",{onClick:n[0]||(n[0]=()=>b(t).setCurrentNode(e.node.parentId))},[h(" ["+v(e.coupletNumber)+"] ",1),u("span",{innerHTML:e.node.text},null,8,se),isNaN(e.node.targetLabel)?(r(),i("span",re,"["+v(e.node.targetLabel)+"]",1)):_("",!0)]),(r(!0),i(T,null,L(e.node.children,a=>(r(),i(T,null,[b(t).state.nodes[a]?(r(),N(S,{key:0,node:b(t).state.nodes[a],"couplet-number":e.node.coupletNumber},null,8,["node","couplet-number"])):_("",!0)],64))),256))])]))}}),le={class:"pinpoint-modal-panel"},ie={__name:"Modal",emits:["close"],setup(o,{emit:t}){const e=t,n=a=>{a.key==="Escape"&&(a.stopPropagation(),e("close"))};return K(()=>{document.addEventListener("keydown",n),document.body.classList.add("overflow-hidden")}),Q(()=>{document.removeEventListener("keydown",n),document.body.classList.remove("overflow-hidden")}),(a,s)=>(r(),i("div",{class:"pinpoint-modal-wrapper",onClick:s[1]||(s[1]=p=>e("close")),onKey:s[2]||(s[2]=O(p=>e("close"),["stop"]))},[u("div",{class:"pinpoint-modal-container",onClick:s[0]||(s[0]=O(()=>{},["stop"]))},[u("div",le,[k(a.$slots,"default")])])],32))}},ue=["src"],de=["src"],ce=j({__name:"FigureItem",props:{figure:{}},setup(o){const t=E(!1);return(e,n)=>(r(),i("div",null,[u("img",{src:e.figure.image,class:"pinpoint-figure",onClick:n[0]||(n[0]=()=>t.value=!t.value)},null,8,ue),t.value?(r(),N(ie,{key:0,onClose:n[2]||(n[2]=()=>t.value=!1)},{default:d(()=>[u("img",{class:"pinpoint-figure-image",src:e.figure.original,onClick:n[1]||(n[1]=()=>t.value=!0)},null,8,de)]),_:1})):_("",!0)]))}}),pe={class:"pinpoint-figure-list"},me=j({__name:"FigureList",props:{figures:{}},setup(o){return(t,e)=>(r(),i("div",pe,[(r(!0),i(T,null,L(t.figures,n=>(r(),N(ce,{key:n.image,figure:n},null,8,["figure"]))),128))]))}}),be={class:"pinpoint-node-container"},fe={class:"pinpoint-node"},_e={class:"pinpoint-node-text"},ge={key:1,class:"pinpoint-node-target"},ve={key:0,class:"pinpoint-node-children-container"},ye={class:"pinpoint-node-next-container"},ke=j({__name:"Node",props:{node:{}},setup(o){const t=I("store");return(e,n)=>(r(),i("div",be,[e.node?(r(),i(T,{key:0},[u("div",fe,[e.node.children.length?(r(),i("button",{key:0,class:"pinpoint-button-go",type:"button",onClick:n[0]||(n[0]=()=>b(t).state.currentNode=e.node)}," Go ")):_("",!0),u("p",_e,v(e.node.text),1),isNaN(e.node.targetLabel)?(r(),i("p",ge,[k(e.$slots,"target",{label:e.node.targetLabel,id:e.node.targetId},()=>[h(v(e.node.targetLabel),1)])])):_("",!0),c(me,{figures:e.node.figures},null,8,["figures"])]),e.node.children.length?(r(),i("div",ve,[u("div",ye,[u("button",{class:"pinpoint-node-next-button",type:"button",onClick:n[1]||(n[1]=a=>b(t).setCurrentNode(b(t).state.nodes[e.node.children[0]].parentId))},[k(e.$slots,"button-next-label",{},()=>[n[2]||(n[2]=h(" Next "))])])]),(r(!0),i(T,null,L(e.node.children.map(a=>b(t).state.nodes[a]),a=>(r(),N(S,{"couplet-number":e.node.coupletNumber,node:a},null,8,["couplet-number","node"]))),256))])):_("",!0)],64)):_("",!0)]))}}),he={class:"pinpoint-couplet"},Ne={class:"pinpoint-couplet-container"},Ce={class:"pinpoint-couplet-node"},Te={key:0},je={key:1,class:"pinpoint-node-target"},we={class:"pinpoint-couplet-children-container"},xe={__name:"Couplet",setup(o){const t=I("store"),e=$(()=>t.state.currentNode),n=$(()=>t.state.currentNode.children.map(a=>t.state.nodes[a]));return(a,s)=>(r(),i("div",he,[u("div",Ne,[b(t).state.currentNode.parentId?(r(),i("button",{key:0,class:"pinpoint-button-up",type:"button",onClick:s[0]||(s[0]=()=>b(t).state.currentNode=b(t).state.nodes[e.value.parentId])},[k(a.$slots,"button-up-label",{},()=>[s[1]||(s[1]=h("Up"))])])):_("",!0),u("div",Ce,[e.value.parentId?(r(),i("h1",Te," Couplet "+v(e.value.coupletNumber),1)):_("",!0),isNaN(e.value.targetLabel)&&!e.value.parentId?(r(),i("p",je,[k(a.$slots,"target",{label:e.value.targetLabel,id:e.value.targetId},()=>[h(v(e.value.targetLabel),1)])])):_("",!0)])]),u("div",we,[(r(!0),i(T,null,L(n.value,p=>(r(),N(ke,{node:p,key:p.id},{target:d(({id:y,label:l})=>[k(a.$slots,"target",{id:y,label:l})]),"button-next-label":d(()=>[k(a.$slots,"button-next-label")]),_:2},1032,["node"]))),128))])]))}},Ie={key:0},R=j({__name:"PreviousList",props:{nodes:{}},setup(o){const t=I("store");return(e,n)=>{var a;return(a=e.nodes)!=null&&a.length?(r(),i("ul",Ie,[u("li",null,[u("span",{class:"pinpoint-previous-list-item",onClick:n[0]||(n[0]=()=>b(t).setCurrentNode(e.nodes[0].parentId))},"["+v(b(W)(e.nodes[0].coupletNumber))+"] "+v(e.nodes[0].text),1),c(R,{nodes:e.nodes.slice(1)},null,8,["nodes"])])])):_("",!0)}}}),Le={class:"pinpoint-previous-couplets"},Ve={class:"pinpoint-previous-list"},$e=j({__name:"PreviousCouplets",props:{node:{}},setup(o){const t=o,e=I("store"),n=$(()=>{const a=[];let s=t.node.id;for(;s!==null;){const p=e.state.nodes[s];s=p.parentId,a.unshift(p)}return a.splice(0,1),a});return(a,s)=>(r(),i("div",Le,[s[0]||(s[0]=u("h2",null,"Previous couplets",-1)),u("div",Ve,[c(R,{nodes:n.value},null,8,["nodes"])])]))}}),x={Loading:"loading",Error:"error",End:"end",Start:"start"},Ee={class:"pinpoint-app"},Me={key:0,class:"pinpoint-key-title"},Oe={key:3},Ue=j({__name:"VuePinpoint",props:{leadId:{},projectToken:{},baseUrl:{}},emits:Object.values(x),setup(o,{expose:t,emit:e}){const n=o,a=e,s=oe(n),p=$(()=>s.state.currentNode),y=E(null);return z("store",s),A([()=>n.leadId,()=>n.projectToken,()=>n.baseUrl],()=>{s.reset(),s.setConfig(n),y.value=null,n.leadId&&n.baseUrl&&n.projectToken&&n.baseUrl&&(a(x.Start),a(x.Loading),s.loadKey(n.leadId).then(l=>{a(x.End,l)}).catch(l=>{a(x.Error,l),y.value=l}))},{immediate:!0}),t({getState:()=>s.state}),(l,m)=>{var f;return r(),i("div",Ee,[b(s).state.metadata?(r(),i("div",Me,[k(l.$slots,"title",{title:b(s).state.metadata.title,metadata:b(s).state.metadata},()=>[h(v(b(s).state.metadata.title),1)])])):_("",!0),(f=p.value)!=null&&f.parentId?(r(),N($e,{key:1,node:p.value},null,8,["node"])):_("",!0),p.value?(r(),N(xe,{key:2},{target:d(({id:C,label:w})=>[k(l.$slots,"target",{label:w,id:C})]),"button-up-label":d(()=>[k(l.$slots,"button-up-label")]),"button-next-label":d(()=>[k(l.$slots,"button-next-label")]),_:3})):_("",!0),y.value?(r(),i("div",Oe,v(y.value.message),1)):_("",!0)])}}}),Be={class:"p-4 pt-0"},Pe={__name:"MetadataModal",props:{metadata:{type:Object,required:!0}},setup(o){const t=E(!1);return(e,n)=>{const a=g("IconInformation"),s=g("VButton"),p=g("VTableHeaderCell"),y=g("VTableHeaderRow"),l=g("VTableHeader"),m=g("VTableBodyCell"),f=g("VTableBodyRow"),C=g("VTableBody"),w=g("VTable"),V=g("VModal");return r(),i(T,null,[c(s,{primary:"",class:"!px-1 py-1 rounded-full",title:"Metadata",onClick:n[0]||(n[0]=M=>t.value=!0)},{default:d(()=>[c(a,{class:"w-4 h-4"})]),_:1}),t.value?(r(),N(V,{key:0,onClose:n[1]||(n[1]=()=>t.value=!1)},{header:d(()=>[...n[2]||(n[2]=[u("h3",{class:"font-medium"},"Metadata",-1)])]),default:d(()=>[u("div",Be,[c(w,null,{default:d(()=>[c(l,null,{default:d(()=>[c(y,null,{default:d(()=>[c(p,null,{default:d(()=>[...n[3]||(n[3]=[h("Data",-1)])]),_:1}),c(p)]),_:1})]),_:1}),c(C,null,{default:d(()=>[(r(!0),i(T,null,L(Object.entries(o.metadata),([M,D])=>(r(),N(f,{key:M},{default:d(()=>[c(m,{class:"capitalize"},{default:d(()=>[h(v(M.replaceAll("_"," ")),1)]),_:2},1024),c(m,null,{default:d(()=>[h(v(D),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})])]),_:1})):_("",!0)],64)}}};var H={url:"https://sfg.taxonworks.org/api/v1",project_token:"NwDdMde5__27Q7McrZm7Ng"};const He={class:"flex flex-col h-full container mx-auto"},Se={class:"flex gap-2 justify-center items-center"},Re={class:"flex gap-2 items-center"},De={class:"flex gap-2 items-center"},Fe={__name:"keyId",setup(o){const t=G(),e=E({leadId:t.params.id,baseUrl:H.url,projectToken:H.project_token});return(n,a)=>{const s=g("IconArrowUp"),p=g("IconArrowDown"),y=g("RouterLink"),l=g("ClientOnly");return r(),i("div",He,[c(l,null,{default:d(()=>[c(b(Ue),Z({ref:"pinpoint"},e.value),{title:d(({metadata:m})=>[u("div",Se,[u("h1",null,v(m.title),1),c(Pe,{metadata:m},null,8,["metadata"])])]),"button-up-label":d(()=>[u("div",Re,[c(s,{class:"h-3"}),a[0]||(a[0]=h(" Back ",-1)),c(s,{class:"h-3"})])]),"button-next-label":d(()=>[u("div",De,[c(p,{class:"h-3"}),a[1]||(a[1]=h(" Next ",-1)),c(p,{class:"h-3"})])]),target:d(({id:m,label:f})=>[c(y,{to:{name:"otus-id",params:{id:m}},innerHTML:f},null,8,["to","innerHTML"])]),_:1},16)]),_:1})])}}};export{Fe as default};
