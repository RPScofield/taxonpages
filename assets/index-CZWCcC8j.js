import{s as q,t as c,e as _,f as p,h as n,F as I,i as P,v as s,H as U,k as f,q as E,r as C,j as $,x as T,O as h,P as O,c as R,z as H,B as Z,w as ee,Q as te,u as le,o as oe}from"./index-CV6KFYyF.js";import ne from"./GalleryThumbnailList-CMVtG3aV.js";function ae(d,u=null,r="application/octet-stream"){const o=window.URL.createObjectURL(new Blob([d],{type:r})),l=document.createElement("a");l.href=o,u||(u=`file_${new Date().toISOString().replace(/[:.]/g,"-")}`),l.setAttribute("download",u),document.body.appendChild(l),l.click(),l.parentNode.removeChild(l),window.URL.revokeObjectURL(o)}function z(d,u=""){const r={};for(const o in d){if(!d.hasOwnProperty(o))continue;const l=d[o],a=u?`${u}[${o}]`:o;Array.isArray(l)?r[`${a}[]`]=l:typeof l=="object"&&l!==null?Object.assign(r,z(l,a)):r[a]=l}return r}const se={class:"flex flex-col flex-wrap gap-2 mt-2"},re={class:"capitalize"},ue={__name:"FacetOrder",props:{modelValue:{type:Object,required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(d){const u=["kingdom","phylum","class","order","family","genus","subgenus","specificEpithet","infraspecificEpithet"],r=q(d,"modelValue");return(o,l)=>{const a=c("InputText");return p(),_("div",null,[l[0]||(l[0]=n("label",{class:"text-base font-medium"},"Classification",-1)),n("div",se,[(p(),_(I,null,P(u,e=>n("div",{key:e,class:"flex flex-col"},[n("label",re,U(e),1),s(a,{placeholder:"Type name...",modelValue:r.value[e],"onUpdate:modelValue":V=>r.value[e]=V},null,8,["modelValue","onUpdate:modelValue"])])),64))])])}}},ie={class:"w-full"},de={class:"flex flex-col md:flex-row gap-2 w-full"},ce={__name:"FacetDistribution",props:{modelValue:{type:Object,required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(d){const u=q(d,"modelValue");return(r,o)=>{const l=c("Autocomplete");return p(),_("div",ie,[o[3]||(o[3]=n("label",null,"Distribution",-1)),n("div",de,[s(l,{class:"w-full",url:"/dwc_occurrences/area_autocomplete","query-param":"term",input:u.value.country,"onUpdate:input":o[0]||(o[0]=a=>u.value.country=a),"retain-input":"",params:{target:"country"},placeholder:"Country..."},null,8,["input"]),s(l,{class:"w-full",url:"/dwc_occurrences/area_autocomplete","query-param":"term","retain-input":"",input:u.value.stateProvince,"onUpdate:input":o[1]||(o[1]=a=>u.value.stateProvince=a),params:{target:"stateProvince"},placeholder:"State/Province..."},null,8,["input"]),s(l,{class:"w-full",url:"/dwc_occurrences/area_autocomplete","query-param":"term","retain-input":"",input:u.value.county,"onUpdate:input":o[2]||(o[2]=a=>u.value.county=a),params:{target:"county"},placeholder:"County..."},null,8,["input"])])])}}},pe=["value"],me={__name:"FacetTypeStatus",props:{modelValue:{type:Object,required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(d){const u=["neotype","holotype","neolectotype","lectotype","syntype","paralectotype","paratype"],r=q(d,"modelValue");return(o,l)=>{const a=c("SelectInput");return p(),_("div",null,[l[2]||(l[2]=n("h3",null,"Type",-1)),s(a,{class:"w-full capitalize",modelValue:r.value.typeStatus,"onUpdate:modelValue":l[0]||(l[0]=e=>r.value.typeStatus=e)},{default:f(()=>[l[1]||(l[1]=n("option",{value:""},"None",-1)),(p(),_(I,null,P(u,e=>n("option",{key:e,value:e},U(e),9,pe)),64))]),_:1},8,["modelValue"])])}}},fe={__name:"FacetInstitutionCode",props:{modelValue:{type:Object,required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(d){const u=q(d,"modelValue");return(r,o)=>{const l=c("InputText");return p(),_("div",null,[o[1]||(o[1]=n("label",{class:"block"},"Institution code",-1)),s(l,{type:"text",modelValue:u.value.institutionCode,"onUpdate:modelValue":o[0]||(o[0]=a=>u.value.institutionCode=a),placeholder:"Type..."},null,8,["modelValue"])])}}},ve={class:"flex flex-col gap-2"},ye={class:"flex flex-col lg:flex-row justify-center items-center gap-4 lg:gap-2 text-sm"},_e={class:"text-sm w-full"},be={class:"w-full lg:w-96"},xe={class:"hidden md:flex flex-row gap-2 justify-center md:self-end text-sm"},Ve={class:"text-secondary-color flex flex-row gap-1 cursor-pointer"},ge={key:0,class:"text-sm pt-4 flex gap-4"},we={class:"flex flex-col gap-2"},Ce={class:"flex md:hidden flex-row gap-2 justify-center md:self-end text-sm"},$e={__name:"FilterBar",props:{modelValue:{type:Object,required:!0},modelModifiers:{}},emits:E(["search"],["update:modelValue"]),setup(d,{emit:u}){const r=q(d,"modelValue"),o=u,l=C(!1);return(a,e)=>{const V=c("InputText"),b=c("VButton"),i=c("IconMinusCircle"),v=c("IconPlusCircle"),y=c("VCardContent"),M=c("VCard");return p(),$(M,{class:"mb-4"},{default:f(()=>[s(y,null,{default:f(()=>[n("div",ve,[n("div",ye,[n("div",_e,[e[13]||(e[13]=n("label",null,"Scientific name",-1)),s(V,{class:"block w-full",type:"text",placeholder:"Type name...",modelValue:r.value.scientificName,"onUpdate:modelValue":e[0]||(e[0]=x=>r.value.scientificName=x),onKeypress:e[1]||(e[1]=h(()=>o("search"),["enter"]))},null,8,["modelValue"])]),n("div",be,[e[14]||(e[14]=n("label",null,"Author",-1)),s(V,{class:"block w-full",type:"text",placeholder:"Type author...",modelValue:r.value.scientificNameAuthorship,"onUpdate:modelValue":e[2]||(e[2]=x=>r.value.scientificNameAuthorship=x),onKeypress:e[3]||(e[3]=h(()=>o("search"),["enter"]))},null,8,["modelValue"])]),s(ce,{modelValue:r.value,"onUpdate:modelValue":e[4]||(e[4]=x=>r.value=x)},null,8,["modelValue"]),n("div",xe,[s(b,{class:"py-1.5 border border-primary-color",primary:"",onClick:e[5]||(e[5]=()=>o("search"))},{default:f(()=>[...e[15]||(e[15]=[O(" Search ",-1)])]),_:1}),s(b,{class:"py-1.5 border border-primary-color",primary:"",onClick:e[6]||(e[6]=()=>o("reset"))},{default:f(()=>[...e[16]||(e[16]=[O(" Reset ",-1)])]),_:1})])]),n("div",null,[n("div",{class:"text-sm mt-2",onClick:e[7]||(e[7]=()=>{l.value=!l.value})},[n("div",Ve,[l.value?(p(),$(i,{key:0,class:"w-5 h-5"})):(p(),$(v,{key:1,class:"w-5 h-5"})),e[17]||(e[17]=n("span",null,"More filters",-1))])])]),l.value?(p(),_("div",ge,[s(ue,{modelValue:r.value,"onUpdate:modelValue":e[8]||(e[8]=x=>r.value=x)},null,8,["modelValue"]),n("div",we,[e[18]||(e[18]=n("h3",{class:"text-base font-medium"},"Specimen records",-1)),s(fe,{modelValue:r.value,"onUpdate:modelValue":e[9]||(e[9]=x=>r.value=x)},null,8,["modelValue"]),s(me,{modelValue:r.value,"onUpdate:modelValue":e[10]||(e[10]=x=>r.value=x)},null,8,["modelValue"])])])):T("",!0),n("div",Ce,[s(b,{class:"py-1.5 border border-primary-color",primary:"",onClick:e[11]||(e[11]=()=>o("search"))},{default:f(()=>[...e[19]||(e[19]=[O(" Search ",-1)])]),_:1}),s(b,{class:"py-1.5 border border-primary-color",primary:"",onClick:e[12]||(e[12]=()=>o("reset"))},{default:f(()=>[...e[20]||(e[20]=[O(" Reset ",-1)])]),_:1})])])]),_:1})]),_:1})}}},ke={key:0,class:"p-5 font-normal"},Te={class:"pb-2 text-sm"},Se=["href"],Me={class:"relative"},Ie=["innerHTML"],Oe={__name:"DropdownMenu",props:{request:{type:Object,default:()=>({})},parameters:{type:Object,required:!0}},setup(d){const u=d,r=C(!1),o=R(()=>[{label:"JSON Data",action:()=>r.value=!0},{label:"Download DwC",action:l}]);async function l(){const a=await H.get("/dwc_occurrences.csv",{params:{...u.parameters},responseType:"blob",headers:{Accept:"text/tsv"}}),e=new Date().toISOString().replace(/[:.]/g,"-");ae(a.data,`dwc_occurrences_${e}.tsv`,"text/tsv")}return(a,e)=>{const V=c("IconHamburger"),b=c("Dropdown"),i=c("VClipboard"),v=c("VModal");return p(),_(I,null,[s(b,{items:o.value},{button:f(()=>[s(V,{class:"text-base-soft h-4"})]),_:1},8,["items"]),r.value?(p(),$(v,{key:0,onClose:e[0]||(e[0]=y=>r.value=!1)},{header:f(()=>[...e[1]||(e[1]=[n("h3",null,"JSON Data",-1)])]),default:f(()=>[d.request?(p(),_("div",ke,[n("h3",Te,[e[2]||(e[2]=O(" URL: ",-1)),n("a",{href:d.request.url},U(d.request.url),9,Se)]),n("div",Me,[n("p",{class:"bg-base-background p-2 text-sm font-normal whitespace-pre-wrap",innerHTML:JSON.stringify(d.request.data,null,4)},null,8,Ie),s(i,{class:"absolute right-2 top-2 opacity-75",text:JSON.stringify(d.request.data,null,2)},null,8,["text"])])])):T("",!0)]),_:1})):T("",!0)],64)}}},je={class:"tp-tab-list inline-flex items-center gap-0.5 flex-wrap"},qe={class:"tp-tab-item inline-flex items-center text-sm cursor-pointer"},Le=["onClick"],Re={__name:"TabList",props:E({tabs:{type:Array,required:!0}},{modelValue:{type:Number,required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(d){const u=q(d,"modelValue");return(r,o)=>(p(),_("ul",je,[n("li",qe,[(p(!0),_(I,null,P(d.tabs,(l,a)=>(p(),_("span",{key:l,class:Z(["block py-2 px-3 text-base-content border-b-2 border-transparent",u.value===a&&"border-b-2 !border-secondary-color text-secondary-color"]),onClick:e=>u.value=a},U(l),11,Le))),128))])]))}},Pe={key:0,class:"text-xl text-center flex flex-col justify-center h-36"},Ue={class:"flex flex-col"},De={class:"font-medium"},Ne=["innerHTML"],F={__name:"RecordItems",props:{items:{type:Object,required:!0}},emits:["select"],setup(d,{emit:u}){const r=u;function o(i){return[i.country,i.stateProvince,i.county,i.verbatimLocality].filter(Boolean).join(", ")}function l(i){const{institutionCode:v,institutionID:y}=i;if(v)return y?`<a href="${y}" target="_blank">${v}</a>`:`<span>${v}</span>`}function a({individualCount:i,sex:v}){return v?`${i} ${v}`:`${i} specimen${i>1?"s":""}`}function e({recordedBy:i}){return i?`Col. ${i}`:""}function V({verbatimCoordinates:i}){const v=i?.split(" ").join(", ");return v?`(${v})`:""}function b(i){return[a(i),l(i),i.catalogNumber,o(i),V(i),e(i)].filter(Boolean).join("; ")}return(i,v)=>(p(),_(I,null,[d.items.length?T("",!0):(p(),_("div",Pe," No records found. ")),(p(!0),_(I,null,P(d.items,y=>(p(),_("div",{class:"flex justify-between flex-col gap-2 text-sm px-4 py-4 border-b",key:y.id},[n("div",Ue,[n("span",De,U(y.typeStatus),1),n("span",{innerHTML:b(y)},null,8,Ne)]),y.associatedMedia?(p(),$(ne,{key:0,images:y.associatedMedia,class:"flex-row flex-wrap gap-2",onSelectIndex:M=>r("select",{item:y,index:M})},null,8,["images","onSelectIndex"])):T("",!0)]))),128))],64))}},He={class:"flex flex-col"},Be={class:"text-base font-medium"},Ae=["innerHTML"],he={class:"mx-4 min-h-48"},Fe={class:"border-b"},Ee={__name:"OtuModal",props:{otu:{type:Object,required:!0},parameters:{type:Object,required:!0}},setup(d){const u=d,r=R(()=>[`Type material (${y.value.length})`,`Specimen records (${v.value.length})`]),o=C(0),l=C([]),a=C(!1),e=C(!1),V=C(!1),b=C(0),i=C([]),v=R(()=>i.value.filter(m=>m.dwc_occurrence_object_type==="CollectionObject"&&!m.typeStatus)),y=R(()=>i.value.filter(m=>m.dwc_occurrence_object_type==="CollectionObject"&&m.typeStatus));function M(){e.value=!0,H.get("/dwc_occurrences",{params:{"collection_object_query[otu_id][]":u.otu.id,per:1e4,...u.parameters}}).then(async m=>{m.data.sort((t,g)=>t.associatedMedia&&!g.associatedMedia?-1:!t.associatedMedia&&g.associatedMedia?1:0);for(let t=0;t<m.data.length;t++){const g=m.data[t];if(g.associatedMedia){const k=await x(g);g.associatedMedia=k}}i.value=m.data,y.value.length||(b.value=1)}).finally(()=>{e.value=!1})}ee(V,m=>{m&&M()});async function x(m){const t=m.associatedMedia.split("|"),g=[];return t.forEach(k=>{g.push(H.get(k.trim(),{params:{extend:["attribution","depictions","source"]}}))}),await Promise.all(g).then(k=>k.map(j=>j.data))}function D(m,t){l.value=m,o.value=t,a.value=!0}return(m,t)=>{const g=c("IconPlusCircle"),k=c("VSpinner"),j=c("ImageViewer"),N=c("VModal");return p(),_(I,null,[s(g,{class:"size-6 text-secondary-color cursor-pointer",onClick:t[0]||(t[0]=()=>V.value=!0)}),V.value?(p(),$(N,{key:0,onClose:t[8]||(t[8]=()=>V.value=!1)},{header:f(()=>[n("div",He,[n("div",Be,[t[9]||(t[9]=O(" DwC Records - ",-1)),n("span",{innerHTML:d.otu.object_tag},null,8,Ae)]),t[10]||(t[10]=n("i",{class:"text-xs"},"* The results shown here are based on the filters selected in the DwC filter.",-1))])]),default:f(()=>[e.value?(p(),$(k,{key:0})):T("",!0),n("div",he,[n("div",Fe,[s(Re,{tabs:r.value,modelValue:b.value,"onUpdate:modelValue":t[1]||(t[1]=S=>b.value=S)},null,8,["tabs","modelValue"])]),b.value==0?(p(),$(F,{key:0,items:y.value,onSelect:t[2]||(t[2]=({index:S,item:L})=>D(L.associatedMedia,S))},null,8,["items"])):T("",!0),b.value==1?(p(),$(F,{key:1,items:v.value,onSelect:t[3]||(t[3]=({index:S,item:L})=>D(L.associatedMedia,S))},null,8,["items"])):T("",!0),a.value?(p(),$(j,{key:2,images:l.value,index:o.value,next:l.value.length-1>o.value,previous:o.value>0,onSelectIndex:t[4]||(t[4]=S=>o.value=S),onNext:t[5]||(t[5]=()=>o.value++),onPrevious:t[6]||(t[6]=()=>o.value--),onClose:t[7]||(t[7]=()=>a.value=!1)},null,8,["images","index","next","previous"])):T("",!0)])]),_:1})):T("",!0)],64)}}},ze={class:"container mx-auto box-border"},Je={class:"flex flex-row justify-between items-center mb-4"},Ke={class:"flex flex-col md:flex-row gap-3 md:items-center"},Qe={class:"flex flex-col md:flex-row gap-3 md:items-center mt-4"},B=50,Ge={__name:"index",setup(d){const u=te(),r=le(),o=C([]),l=C(!1),a=C({page:1,total:0,per:B}),e=C({}),V=C(),b=R(()=>({wildcard_attribute:Object.keys(e.value)}));function i(m){return{page:Number(m["pagination-page"]),per:Number(m["pagination-per-page"]),total:Number(m["pagination-total"])}}function v(m={}){e.value=m}function y(m={}){a.value={page:Number(m.page)||1,total:0,per:B}}function M(){r.push({query:{...e.value,page:a.value.page}})}function x(m=1){l.value=!0,H.get("/otus/inventory/alphabetical",{params:{...z({dwc_occurrence_query:{...e.value,...b.value}}),page:m,per:B}}).then(({data:t,headers:g,request:k})=>{o.value=t,a.value=i(g),V.value={data:t,url:k.responseURL},M()}).finally(()=>{l.value=!1})}function D(){v(),y(),M(),o.value=[]}return oe(()=>{const{page:m,...t}=u.query;v(t),y({page:m}),x()}),(m,t)=>{const g=c("VSpinner"),k=c("ClientOnly"),j=c("VPagination"),N=c("VPaginationInfo"),S=c("VTableHeaderCell"),L=c("VTableHeaderRow"),J=c("VTableHeader"),A=c("VTableBodyCell"),K=c("RouterLink"),Q=c("VTableBodyRow"),Y=c("VTableBody"),W=c("VTable"),G=c("VCardContent"),X=c("VCard");return p(),_("div",ze,[t[7]||(t[7]=n("div",{class:"px-4 md:px-0 mt-4 mb-6"},[n("h1",{class:"text-4xl font-bold"},"Search the Darwin Core"),n("h2",null," Filter OTUs by scientific name, author, and distribution (Darwin Core) ")],-1)),s(k,null,{default:f(()=>[l.value?(p(),$(g,{key:0,"full-screen":""})):T("",!0)]),_:1}),s($e,{modelValue:e.value,"onUpdate:modelValue":t[0]||(t[0]=w=>e.value=w),onSearch:t[1]||(t[1]=()=>x()),onReset:D},null,8,["modelValue"]),s(X,null,{default:f(()=>[s(G,null,{default:f(()=>[n("div",Je,[n("div",Ke,[s(j,{modelValue:a.value.page,"onUpdate:modelValue":[t[2]||(t[2]=w=>a.value.page=w),t[3]||(t[3]=w=>{x(w)})],total:a.value.total,per:a.value.per},null,8,["modelValue","total","per"]),s(N,{pagination:a.value},null,8,["pagination"])]),s(Oe,{parameters:{...e.value,...b.value},request:V.value},null,8,["parameters","request"])]),s(W,null,{default:f(()=>[s(J,null,{default:f(()=>[s(L,null,{default:f(()=>[s(S,{class:"w-2"}),s(S,null,{default:f(()=>[...t[6]||(t[6]=[O("OTU",-1)])]),_:1})]),_:1})]),_:1}),s(Y,null,{default:f(()=>[(p(!0),_(I,null,P(o.value,w=>(p(),$(Q,{key:w.id},{default:f(()=>[s(A,{class:"pr-1"},{default:f(()=>[s(Ee,{otu:w,parameters:{...e.value,...b.value}},null,8,["otu","parameters"])]),_:2},1024),s(A,{class:"break-all"},{default:f(()=>[s(K,{to:{name:"otus-id",params:{id:w.id}},innerHTML:w.object_tag},null,8,["to","innerHTML"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),n("div",Qe,[s(j,{modelValue:a.value.page,"onUpdate:modelValue":t[4]||(t[4]=w=>a.value.page=w),total:a.value.total,per:a.value.per,onSelect:t[5]||(t[5]=w=>{x(w)})},null,8,["modelValue","total","per"]),s(N,{pagination:a.value},null,8,["pagination"])])]),_:1})]),_:1})])}}};export{Ge as default};
